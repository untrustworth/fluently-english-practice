# 英会話練習アプリ要件定義書

## プロジェクト概要

### 目的

劇場レセプション職員（妻）が外国人観光客との英会話を練習するための Web アプリケーション

### ターゲットユーザー

- **主要ユーザー**: 劇場レセプション職員（英語初心者）
- **想定シーン**: クラシカル劇場のチケットセンターでの接客

### 役割設定

- **ユーザー（妻）**: 劇場職員（日本人スタッフ）
- **アプリ**: 外国人観光客

## システム構成

### アーキテクチャ

- **フロントエンド**: PWA（Progressive Web App）
- **ホスティング**: GitHub Pages（無料）
- **AI 処理**: Google AI Studio（Gemini 2.0 Flash 無料枠を活用）
- **音声処理**: Web Speech API（ブラウザ標準機能）

### 技術スタック

- HTML/CSS/JavaScript（静的ファイル）
- Web Speech API（音声認識・合成）
- Google AI Studio API（Gemini 2.0 Flash 001）
- LocalStorage（設定保存）

### 対応環境

- **OS**: Windows/macOS/Android/iOS 対応
- **ブラウザ**: **Google Chrome 専用**（Web Speech API の完全対応のため）
- **インターネット**: オンライン必須（AI 処理のため）

## 機能要件

### 1. 英語会話機能

#### 1.1 音声入力

- Web Speech API による音声認識
- ユーザー（職員）の英語発話をテキスト化
- 1.5秒の猶予時間付き自動停止制御
- 録音終了待機機能による自然な会話リズム

#### 1.2 AI 会話処理

- Google AI Studio（Gemini 2.0 Flash）による自然な英語返答生成
- 外国人観光客としての適切な応答
- 会話文脈の継続性（初回：シチュエーション重視、2回目以降：会話履歴考慮）
- 日本語システムプロンプトによる高精度な文脈理解

#### 1.3 音声出力

- Web Speech API による音声合成
- 標準的な米国英語での自然な発音

### 2. 学習支援機能

#### 2.1 ヒント機能

- 何と言えばよいかわからない時のサポート
- ヒントボタン押下で日本語入力フォームが表示
- 日本語を入力すると、Gemini 2.0 Flash が適切な英語表現を提案
- シチュエーションに応じた自然な英語表現を学習可能

#### 2.2 会話ログ機能

- AI 返答の音声出力（字幕表示なし）
- 会話ログは必要時のみ表示（ボタン押下中）
- **プライバシー保護**: 会話終了時にすべての会話データを完全削除

#### 2.3 プライバシー配慮

- **学習利用警告**: 無料版APIのため入力内容が学習に利用される旨を明示
- **個人情報保護**: 個人情報入力を控えるよう注意書きを表示

### 3. シチュエーション設定機能

#### 3.1 ランダムシチュエーション機能

- プリセットからランダム選択
- ワンクリックで即座に会話開始
- シチュエーション表示機能

#### 3.2 プリセットシチュエーション

以下の場面を事前定義（クリックで即座に会話開始）：

- チケット予約
- トイレ案内
- 今日の公演情報
- 座席相談
- 忘れ物対応
- 館内道案内
- 貸し会議室案内
- 近隣観光地案内
- グッズ案内

#### 3.3 カスタムシチュエーション

- ユーザーが独自の状況を設定可能
- タイトルと詳細説明を入力
- 入力内容を AI プロンプトに反映
- **一覧への自動追加**: カスタム入力したシチュエーションを自動的に一覧に追加
- **ワンクリック開始**: 追加されたアイテムをクリックで即座に会話開始

#### 3.4 シチュエーション管理

- プリセットの追加・編集・削除
- カスタム設定の保存・読み込み
- ブラウザの LocalStorage に永続保存

### 4. ユーザーインターフェース

#### 4.1 ホーム画面

- ランダムシチュエーション会話ボタン（メイン機能）
- シチュエーションを選ぶボタン
- 管理画面ボタン

#### 4.2 シチュエーション選択画面

- プリセット一覧から選択
- カスタムシチュエーション入力
- 会話開始ボタン

#### 4.2 会話画面

- 音声入力ボタン
- ヒントボタン（日本語→英語翻訳）
- 会話ログボタン（押している間のみログ表示）
- シチュエーション表示
- 次の会話ボタン（ヘッダー右端配置、ワンクリックでランダム会話切り替え）
- プライバシー注意書き（入力内容が学習に利用される旨）
- ホームに戻るボタン

#### 4.3 PWA 機能

- ホーム画面への追加対応
- アプリライクなユーザー体験
- オフライン時の基本機能保持

## 想定する接客シーン

### 劇場の特徴

- クラシカルな劇場（コンサート・バレエ）
- レセプション・チケットセンター
- 多国籍の来場者（中国・韓国・東南アジア・オーストラリア等）

### 対応業務

- 公演情報の案内
- チケット予約・購入
- 座席に関する問い合わせ
- 忘れ物・迷子対応
- 館内・周辺の道案内
- 施設設備の案内
- グッズ販売
- 貸し会議室の予約・案内
- 近隣観光地の情報提供

## 非機能要件

### セキュリティ

#### 高優先度対策

- **API キー保護**: 使用量制限の実装（1 時間 1000 回、1 日 1500 回）
- **API キー管理**: 暗号化保存と完全削除機能
- **入力データ検証**: ユーザー入力のサニタイゼーション、プロンプトインジェクション対策
- **データ保護**: 会話ログは会話終了時に完全削除（一切保持しない）
- **プライバシー保護**: 無料版API使用による学習利用の明示

#### 基本対策

- HTTPS 通信（GitHub Pages 標準対応）
- API キーの暗号化保存とLocalStorage管理
- エラー情報の制御とユーザーフレンドリーなメッセージ

### 費用

- **完全無料運用**
- GitHub Pages：無料
- Google AI Studio：無料枠（15 RPM、1M TPM、1500 RPD）
- 独自ドメイン：不使用

### パフォーマンス

- リアルタイム応答（1-2 秒以内）
- 音声品質の確保
- ネットワーク使用量の最適化
- ローディング画面なしの自然な会話体験

### 可用性

- GitHub Pages の安定性に依存
- Google Chrome での安定動作を前提

## 制約事項

### 技術的制約

- サーバーサイド処理なし（静的サイト）
- **Google Chrome 専用**（Web Speech API の安定性確保のため）
- ブラウザ API 機能に依存
- インターネット接続必須

### 機能的制約

- ユーザー同士の交流機能なし
- 学習進捗管理機能なし（初期段階）
- 音声合成での訛り再現不可

### 運用制約

- 個人利用のみ
- 収益化機能なし

## 今後の拡張可能性

### スケーラビリティ

- 他業種への応用
- 多言語対応
- 企業向け機能

## 開発・運用方針

### 開発アプローチ

- アジャイル開発
- MVP（最小実行可能製品）から開始
- ユーザーフィードバックに基づく改善

### 品質保証

- Google Chrome での動作確認
- 音声機能のテスト
- セキュリティチェック

### 保守・運用

- GitHub Pages での自動デプロイ
- Google AI Studio API 使用量監視
- API キーの適切な管理とセキュリティ維持

## 変更履歴

### v1.2.0 - 2025年01月
#### 会話継続性改善
- **次の会話ボタン追加**
  - 会話画面ヘッダー右端に「🎲 次の会話」ボタンを配置
  - ワンクリックで新しいランダムシチュエーション会話を開始
  - ホーム画面に戻らずに継続的な英会話練習が可能

#### UI/UXの最適化
- **ヘッダーレイアウト改善**
  - 左端「🏠 終了」、中央「シチュエーション名」、右端「🎲 次の会話」の配置
  - 会話ログエリアの視認性向上（ボタン移動により広いエリア確保）
  - Flexboxレイアウトによる応答性の高いデザイン

### v1.1.0 - 2024年12月
#### UI/UX改善
- **シチュエーション選択の改善**
  - プリセットシチュエーションをクリックで直接会話開始
  - カスタムシチュエーション入力後、一覧に自動追加
  - 「会話開始」ボタンを「➕ 追加」ボタンに変更
  - ワンクリック操作でより直感的なユーザー体験を実現

#### 会話システム改善
- **会話文脈の継続性向上**
  - 初回会話：シチュエーション重視のプロンプト
  - 2回目以降：会話履歴を考慮した文脈重視のプロンプト
  - 自然な会話の流れを実現（例：公演情報 → 座席予約 → 座席選択）
  - システムプロンプトを日本語化（性能向上・保守性向上）

#### 音声機能改善
- **音声認識の猶予時間延長**
  - 1.5秒の猶予時間を追加（continuous = true + タイマー実装）
  - ユーザーの発話完了後の自動停止制御
  - より自然な音声入力体験を実現

- **音声合成タイミング最適化**
  - AIの返答を録音終了まで待機する機能
  - ユーザー発話とAI応答の重複を防止
  - 自然な会話リズムの実現

#### パフォーマンス改善
- **ローディング画面の削除**
  - フルスクリーンローディングを完全削除
  - よりスムーズで自然な会話体験
  - 不要なUI要素の除去による可読性向上

### v1.3.0 - 2025年01月
#### UI/UXデザイン大幅改善
- **背景デザイン刷新**
  - ピンクから紫へのグラデーション背景に変更
  - より現代的で美しいビジュアルデザイン
  - 透明感のあるエレガントな外観

#### 視認性とアクセシビリティ向上
- **テキストシャドウ対応**
  - 全ての白文字にテキストシャドウを追加
  - 新しいグラデーション背景での読みやすさを大幅向上
  - 清潔感のある白文字デザインを維持

#### インターフェース統一と日本語化
- **ボタンデザイン統一**
  - 全てのボタンを半透明背景デザインに統一
  - ホーム画面の3つのボタンサイズを統一（btn-medium）
  - 一貫性のある美しいインターフェース

- **完全日本語化**
  - 全ての英語テキスト・ラベル・メッセージを日本語に変更
  - ユーザーフレンドリーな日本語インターフェース
  - プレースホルダーテキストも日本語対応

#### 会話画面ヘッダー最適化
- **左右対称デザイン**
  - 小さな円形アイコンボタン（🏠終了・🎲次の会話）
  - 中央のシチュエーション情報を強調
  - スマホでも使いやすいコンパクトなデザイン

#### ブランディング強化
- **ロゴのビジュアル化**
  - テキストロゴからFluently.png画像ロゴに変更
  - ドロップシャドウ効果による立体感
  - レスポンシブ対応（デスクトップ240px、モバイル180px）
  - 装飾線を削除してクリーンな外観

#### プラットフォーム最適化
- **Google Chrome 専用化**
  - Web Speech API の安定性確保のため Google Chrome 専用に特化
  - 音声認識機能の信頼性向上
  - continuous モードによる自然な会話体験の実現
  - クロスブラウザ対応の複雑性を排除

### v1.0.0 - 2024年12月
#### 初期リリース
- 基本的な英会話練習機能
- シチュエーション管理機能
- 音声認識・合成機能
- API キー管理機能
- プライバシー保護機能
